<openerp>
    <data>
        <record id="view_employee_form" model="ir.ui.view">
			<field name="name">HR Employee form with user</field>
			<field name="model">hr.employee</field>
			<field name="inherit_id" ref="hr.view_employee_form"/>
			<field name="arch" type="xml">

				<!-- Invitation buttons -->
				<div name="button_box" position="inside">
					<field name="user_state" invisible="1" />
	                <button string="Send Reset Password Instructions"
	                        class="oe_link"
	                        type="object" name="action_reset_password"
	                        attrs="{'invisible': [('user_state', '!=', 'active')]}"/>
	                <button string="Send an Invitation Email"
	                        class="oe_link"
	                        type="object" name="action_reset_password" context="{'create_user': 1}"
	                        attrs="{'invisible': [('user_state', '!=', 'new')]}"/>
				</div>

				<!-- Set email as required for user creation and move it right after name -->
				<field name="work_email" position="replace" />
				<label for="work_email" position="replace" />
				
				<label for="category_ids" position="before">
					<label for="work_email" class="oe_edit_only"/>
					<field name="work_email" required="1" widget="email"/>
				</label>

				<!-- Add an "User information"-page -->
				<field name="user_id" position="replace" />

				<page string="Personal Information" position="after">
					<page string="User Information" groups="base.group_hr_manager">
						<group string="User">
							<group>
								<field name="user_id" 
								    on_change="onchange_user(user_id)" 
								    string="Related User"
								    context="{'default_groups_ref': ['base.group_user']}"
								/>
							</group>
							<group />
						</group>
					
						<group string="Roles">
                            <group attrs="{'invisible': [('user_id','=',False)]}">
                                <group col='2'>
	                                <field name="show_group_sales" invisible='1'/>
									<field name="group_sales" attrs="{'invisible': [('show_group_sales','=',False)]}"/>
									
	                                <field name="show_group_purchase" invisible='1'/>
									<field name="group_purchase" attrs="{'invisible': [('show_group_purchase','=',False)]}"/>
									
                                    <field name="show_group_account" invisible='1'/>
                                    <field name="group_account" attrs="{'invisible': [('show_group_account','=',False)]}"/>
								</group>
								
								<group col='2'>
	                                <field name="show_group_project" invisible='1'/>
									<field name="group_project" attrs="{'invisible': [('show_group_project','=',False)]}"/>
									
	                                <field name="show_group_stock" invisible='1'/>
									<field name="group_stock" attrs="{'invisible': [('show_group_stock','=',False)]}"/>
									
	                                <field name="show_group_hr" invisible='1'/>
									<field name="group_hr" attrs="{'invisible': [('show_group_hr','=',False)]}"/>
								</group>
							</group>

						</group>
					</page>
				</page>
				
			</field>
        </record>
        
    </data>
</openerp>